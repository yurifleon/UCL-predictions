{% extends "base.html" %}
{% block title %}{{ _('Admin - UCL Forecast') }}{% endblock %}
{% block content %}
<h2 class="mb-4">{{ _('Admin Panel') }}</h2>

{% if not is_admin %}
<div class="row justify-content-center">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">{{ _('Admin Login') }}</div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="action" value="login">
                    <div class="mb-3">
                        <label for="password" class="form-label">{{ _('Password') }}</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">{{ _('Login') }}</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% else %}

<!-- Manage Users -->
<div class="card mb-4">
    <div class="card-header">{{ _('Registered Users ({count}/12)', count=data.users|length) }}</div>
    <div class="card-body">
        {% if data.users %}
        <div class="d-flex flex-wrap gap-2">
            {% for user in data.users %}
            <form method="POST" class="d-inline" onsubmit="return confirm({{ _('Remove user {user}? Their predictions will be deleted.', user=user)|tojson }})">
                <input type="hidden" name="action" value="remove_user">
                <input type="hidden" name="username_to_remove" value="{{ user }}">
                <button type="submit" class="btn btn-outline-danger btn-sm">{{ user }} &times;</button>
            </form>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-muted mb-0">{{ _('No users registered yet.') }}</p>
        {% endif %}
    </div>
</div>

<!-- Add User -->
<div class="card mb-4">
    <div class="card-header">{{ _('Create User (Admin)') }}</div>
    <div class="card-body">
        <p class="text-muted mb-3">{{ _('Create a user with initial login password') }}</p>
        <form method="POST">
            <input type="hidden" name="action" value="add_user">
            <div class="row g-2">
                <div class="col-md-3">
                    <label class="form-label">{{ _('Username') }}</label>
                    <input type="text" class="form-control" name="username" required maxlength="20" autocomplete="username">
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ _('Email') }}</label>
                    <input type="email" class="form-control" name="email" required autocomplete="email">
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ _('Temporary Password') }}</label>
                    <input type="password" class="form-control" name="password" required minlength="6" autocomplete="new-password" placeholder="{{ _('Set initial password') }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ _('Confirm Password') }}</label>
                    <input type="password" class="form-control" name="confirm_password" required minlength="6" autocomplete="new-password" placeholder="{{ _('Repeat password') }}">
                </div>
            </div>
            <button type="submit" class="btn btn-primary mt-3">{{ _('Create User') }}</button>
        </form>
    </div>
</div>

<!-- Add Match -->
<div class="card mb-4">
    <div class="card-header">{{ _('Add Quarterfinal Match') }}</div>
    <div class="card-body">
        <form method="POST">
            <input type="hidden" name="action" value="add_match">
            <div class="row g-2">
                <div class="col-md-3">
                    <label class="form-label">{{ _('Home Team (Leg 1)') }}</label>
                    <input type="text" class="form-control" name="home_team" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ _('Away Team (Leg 1)') }}</label>
                    <input type="text" class="form-control" name="away_team" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ _('Leg 1 Deadline') }}</label>
                    <input type="datetime-local" class="form-control" name="leg1_deadline" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ _('Leg 2 Deadline') }}</label>
                    <input type="datetime-local" class="form-control" name="leg2_deadline" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary mt-3">{{ _('Add Match') }}</button>
        </form>
    </div>
</div>

<!-- Existing Matches -->
{% for m in data.matches %}
<div class="card mb-3">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span><strong>{{ _('Match {id}:', id=m.id) }}</strong> {{ m.home_team }} vs {{ m.away_team }}</span>
        <form method="POST" class="d-inline" onsubmit="return confirm({{ _('Delete this match?')|tojson }})">
            <input type="hidden" name="action" value="delete_match">
            <input type="hidden" name="match_id" value="{{ m.id }}">
            <button type="submit" class="btn btn-outline-danger btn-sm">{{ _('Delete') }}</button>
        </form>
    </div>
    <div class="card-body">
        <div class="row">
            <!-- Edit Teams & Deadlines -->
            <div class="col-md-6">
                <h6>{{ _('Edit Match Details') }}</h6>
                <form method="POST">
                    <input type="hidden" name="action" value="edit_match">
                    <input type="hidden" name="match_id" value="{{ m.id }}">
                    <div class="mb-2">
                        <label class="form-label form-label-sm">{{ _('Home Team') }}</label>
                        <input type="text" class="form-control form-control-sm" name="home_team" value="{{ m.home_team }}">
                    </div>
                    <div class="mb-2">
                        <label class="form-label form-label-sm">{{ _('Away Team') }}</label>
                        <input type="text" class="form-control form-control-sm" name="away_team" value="{{ m.away_team }}">
                    </div>
                    <div class="mb-2">
                        <label class="form-label form-label-sm">{{ _('Leg 1 Deadline') }}</label>
                        <input type="datetime-local" class="form-control form-control-sm" name="leg1_deadline" value="{{ m.leg1_deadline }}">
                    </div>
                    <div class="mb-2">
                        <label class="form-label form-label-sm">{{ _('Leg 2 Deadline') }}</label>
                        <input type="datetime-local" class="form-control form-control-sm" name="leg2_deadline" value="{{ m.leg2_deadline }}">
                    </div>
                    <button type="submit" class="btn btn-sm btn-outline-primary">{{ _('Update Details') }}</button>
                </form>
            </div>

            <!-- Enter Results -->
            <div class="col-md-6">
                <h6>{{ _('Enter Results') }}</h6>
                <form method="POST">
                    <input type="hidden" name="action" value="enter_results">
                    <input type="hidden" name="match_id" value="{{ m.id }}">
                    <div class="mb-2">
                        <label class="form-label form-label-sm">{{ _('Leg 1: {team} goals', team=m.home_team) }}</label>
                        <input type="number" class="form-control form-control-sm" name="actual_leg1_home" min="0"
                               value="{{ m.actual_leg1_home if m.actual_leg1_home is not none else '' }}">
                    </div>
                    <div class="mb-2">
                        <label class="form-label form-label-sm">{{ _('Leg 1: {team} goals', team=m.away_team) }}</label>
                        <input type="number" class="form-control form-control-sm" name="actual_leg1_away" min="0"
                               value="{{ m.actual_leg1_away if m.actual_leg1_away is not none else '' }}">
                    </div>
                    <div class="mb-2">
                        <label class="form-label form-label-sm">{{ _('Leg 2: {team} goals (home)', team=m.away_team) }}</label>
                        <input type="number" class="form-control form-control-sm" name="actual_leg2_home" min="0"
                               value="{{ m.actual_leg2_home if m.actual_leg2_home is not none else '' }}">
                    </div>
                    <div class="mb-2">
                        <label class="form-label form-label-sm">{{ _('Leg 2: {team} goals (away)', team=m.home_team) }}</label>
                        <input type="number" class="form-control form-control-sm" name="actual_leg2_away" min="0"
                               value="{{ m.actual_leg2_away if m.actual_leg2_away is not none else '' }}">
                    </div>
                    <button type="submit" class="btn btn-sm btn-outline-success">{{ _('Save Results') }}</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% if not data.matches %}
<div class="alert alert-info">{{ _('No matches yet. Add one above.') }}</div>
{% endif %}

{% endif %}
{% endblock %}
